(function(e){function t(e){if(typeof e=="undefined")return false;if(e instanceof Array||!(e instanceof Object)&&Object.prototype.toString.call(e)=="[object Array]"||typeof e.length=="number"&&typeof e.splice!="undefined"&&typeof e.propertyIsEnumerable!="undefined"&&!e.propertyIsEnumerable("splice")){return true}return false}function r(){return this.init.apply(this,arguments)}function i(){Draggable.apply(this,arguments)}e.slider=function(t,n){var i=e(t);if(!i.data("jslider"))i.data("jslider",new r(t,n));return i.data("jslider")};e.fn.slider=function(n,r){function o(e){return e!==undefined}function u(e){return e!=null}var i,s=arguments;this.each(function(){var a=e.slider(this,n);if(typeof n=="string"){switch(n){case"value":if(o(s[1])&&o(s[2])){var f=a.getPointers();if(u(f[0])&&u(s[1])){f[0].set(s[1]);f[0].setIndexOver()}if(u(f[1])&&u(s[2])){f[1].set(s[2]);f[1].setIndexOver()}}else if(o(s[1])){var f=a.getPointers();if(u(f[0])&&u(s[1])){f[0].set(s[1]);f[0].setIndexOver()}}else i=a.getValue();break;case"prc":if(o(s[1])&&o(s[2])){var f=a.getPointers();if(u(f[0])&&u(s[1])){f[0]._set(s[1]);f[0].setIndexOver()}if(u(f[1])&&u(s[2])){f[1]._set(s[2]);f[1].setIndexOver()}}else if(o(s[1])){var f=a.getPointers();if(u(f[0])&&u(s[1])){f[0]._set(s[1]);f[0].setIndexOver()}}else i=a.getPrcValue();break;case"calculatedValue":var l=a.getValue().split(";");i="";for(var c=0;c<l.length;c++){i+=(c>0?";":"")+a.nice(l[c])}break;case"skin":a.setSkin(s[1]);break}}else if(!n&&!r){if(!t(i))i=[];i.push(a)}});if(t(i)&&i.length==1)i=i[0];return i||this};var n={settings:{from:1,to:10,step:1,smooth:true,limits:true,round:0,format:{format:"#,##0.##"},value:"5;7",dimension:""},className:"jslider",selector:".jslider-",template:tmpl('<span class="<%=className%>">'+"<table><tr><td>"+'<div class="<%=className%>-bg">'+'<i class="l"></i><i class="f"></i><i class="r"></i>'+'<i class="v"></i>'+"</div>"+'<div class="<%=className%>-pointer"></div>'+'<div class="<%=className%>-pointer <%=className%>-pointer-to"></div>'+'<div class="<%=className%>-label"><span><%=settings.from%></span></div>'+'<div class="<%=className%>-label <%=className%>-label-to"><span><%=settings.to%></span><%=settings.dimension%></div>'+'<div class="<%=className%>-value"><span></span><%=settings.dimension%></div>'+'<div class="<%=className%>-value <%=className%>-value-to"><span></span><%=settings.dimension%></div>'+'<div class="<%=className%>-scale"><%=scale%></div>'+"</td></tr></table>"+"</span>")};r.prototype.init=function(t,r){this.settings=e.extend(true,{},n.settings,r?r:{});this.inputNode=e(t).hide();this.settings.interval=this.settings.to-this.settings.from;this.settings.value=this.inputNode.attr("value");if(this.settings.calculate&&e.isFunction(this.settings.calculate))this.nice=this.settings.calculate;if(this.settings.onstatechange&&e.isFunction(this.settings.onstatechange))this.onstatechange=this.settings.onstatechange;this.is={init:false};this.o={};this.create()};r.prototype.onstatechange=function(){};r.prototype.create=function(){var t=this;this.domNode=e(n.template({className:n.className,settings:{from:this.nice(this.settings.from),to:this.nice(this.settings.to),dimension:this.settings.dimension},scale:this.generateScale()}));this.inputNode.after(this.domNode);this.drawScale();if(this.settings.skin&&this.settings.skin.length>0)this.setSkin(this.settings.skin);this.sizes={domWidth:this.domNode.width(),domOffset:this.domNode.offset()};e.extend(this.o,{pointers:{},labels:{0:{o:this.domNode.find(n.selector+"value").not(n.selector+"value-to")},1:{o:this.domNode.find(n.selector+"value").filter(n.selector+"value-to")}},limits:{0:this.domNode.find(n.selector+"label").not(n.selector+"label-to"),1:this.domNode.find(n.selector+"label").filter(n.selector+"label-to")}});e.extend(this.o.labels[0],{value:this.o.labels[0].o.find("span")});e.extend(this.o.labels[1],{value:this.o.labels[1].o.find("span")});if(!t.settings.value.split(";")[1]){this.settings.single=true;this.domNode.addDependClass("single")}if(!t.settings.limits)this.domNode.addDependClass("limitless");this.domNode.find(n.selector+"pointer").each(function(e){var n=t.settings.value.split(";")[e];if(n){t.o.pointers[e]=new i(this,e,t);var r=t.settings.value.split(";")[e-1];if(r&&new Number(n)<new Number(r))n=r;n=n<t.settings.from?t.settings.from:n;n=n>t.settings.to?t.settings.to:n;t.o.pointers[e].set(n,true)}});this.o.value=this.domNode.find(".v");this.is.init=true;e.each(this.o.pointers,function(e){t.redraw(this)});(function(t){e(window).resize(function(){t.onresize()})})(this)};r.prototype.setSkin=function(e){if(this.skin_)this.domNode.removeDependClass(this.skin_,"_");this.domNode.addDependClass(this.skin_=e,"_")};r.prototype.setPointersIndex=function(t){e.each(this.getPointers(),function(e){this.index(e)})};r.prototype.getPointers=function(){return this.o.pointers};r.prototype.generateScale=function(){if(this.settings.scale&&this.settings.scale.length>0){var e="";var t=this.settings.scale;var n=Math.round(100/(t.length-1)*10)/10;for(var r=0;r<t.length;r++){e+='<span style="left: '+r*n+'%">'+(t[r]!="|"?"<ins>"+t[r]+"</ins>":"")+"</span>"}return e}else return"";return""};r.prototype.drawScale=function(){this.domNode.find(n.selector+"scale span ins").each(function(){e(this).css({marginLeft:-e(this).outerWidth()/2})})};r.prototype.onresize=function(){var t=this;this.sizes={domWidth:this.domNode.width(),domOffset:this.domNode.offset()};e.each(this.o.pointers,function(e){t.redraw(this)})};r.prototype.update=function(){this.onresize();this.drawScale()};r.prototype.limits=function(e,t){if(!this.settings.smooth){var n=this.settings.step*100/this.settings.interval;e=Math.round(e/n)*n}var r=this.o.pointers[1-t.uid];if(r&&t.uid&&e<r.value.prc)e=r.value.prc;if(r&&!t.uid&&e>r.value.prc)e=r.value.prc;if(e<0)e=0;if(e>100)e=100;return Math.round(e*10)/10};r.prototype.redraw=function(e){if(!this.is.init)return false;this.setValue();if(this.o.pointers[0]&&this.o.pointers[1])this.o.value.css({left:this.o.pointers[0].value.prc+"%",width:this.o.pointers[1].value.prc-this.o.pointers[0].value.prc+"%"});this.o.labels[e.uid].value.html(this.nice(e.value.origin));this.redrawLabels(e)};r.prototype.redrawLabels=function(e){function t(e,t,r){t.margin=-t.label/2;label_left=t.border+t.margin;if(label_left<0)t.margin-=label_left;if(t.border+t.label/2>n.sizes.domWidth){t.margin=0;t.right=true}else t.right=false;e.o.css({left:r+"%",marginLeft:t.margin,right:"auto"});if(t.right)e.o.css({left:"auto",right:0});return t}var n=this;var r=this.o.labels[e.uid];var i=e.value.prc;var s={label:r.o.outerWidth(),right:false,border:i*this.sizes.domWidth/100};if(!this.settings.single){var o=this.o.pointers[1-e.uid];var u=this.o.labels[o.uid];switch(e.uid){case 0:if(s.border+s.label/2>u.o.offset().left-this.sizes.domOffset.left){u.o.css({visibility:"hidden"});u.value.html(this.nice(o.value.origin));r.o.css({visibility:"visible"});i=(o.value.prc-i)/2+i;if(o.value.prc!=e.value.prc){r.value.html(this.nice(e.value.origin)+"&nbsp;&ndash;&nbsp;"+this.nice(o.value.origin));s.label=r.o.outerWidth();s.border=i*this.sizes.domWidth/100}}else{u.o.css({visibility:"visible"})}break;case 1:if(s.border-s.label/2<u.o.offset().left-this.sizes.domOffset.left+u.o.outerWidth()){u.o.css({visibility:"hidden"});u.value.html(this.nice(o.value.origin));r.o.css({visibility:"visible"});i=(i-o.value.prc)/2+o.value.prc;if(o.value.prc!=e.value.prc){r.value.html(this.nice(o.value.origin)+"&nbsp;&ndash;&nbsp;"+this.nice(e.value.origin));s.label=r.o.outerWidth();s.border=i*this.sizes.domWidth/100}}else{u.o.css({visibility:"visible"})}break}}s=t(r,s,i);if(u){var s={label:u.o.outerWidth(),right:false,border:o.value.prc*this.sizes.domWidth/100};s=t(u,s,o.value.prc)}this.redrawLimits()};r.prototype.redrawLimits=function(){if(this.settings.limits){var e=[true,true];for(key in this.o.pointers){if(!this.settings.single||key==0){var t=this.o.pointers[key];var n=this.o.labels[t.uid];var r=n.o.offset().left-this.sizes.domOffset.left;var i=this.o.limits[0];if(r<i.outerWidth())e[0]=false;var i=this.o.limits[1];if(r+n.o.outerWidth()>this.sizes.domWidth-i.outerWidth())e[1]=false}}for(var s=0;s<e.length;s++){if(e[s])this.o.limits[s].fadeIn("fast");else this.o.limits[s].fadeOut("fast")}}};r.prototype.setValue=function(){var e=this.getValue();this.inputNode.attr("value",e);this.onstatechange.call(this,e)};r.prototype.getValue=function(){if(!this.is.init)return false;var t=this;var n="";e.each(this.o.pointers,function(e){if(this.value.prc!=undefined&&!isNaN(this.value.prc))n+=(e>0?";":"")+t.prcToValue(this.value.prc)});return n};r.prototype.getPrcValue=function(){if(!this.is.init)return false;var t=this;var n="";e.each(this.o.pointers,function(e){if(this.value.prc!=undefined&&!isNaN(this.value.prc))n+=(e>0?";":"")+this.value.prc});return n};r.prototype.prcToValue=function(e){if(this.settings.heterogeneity&&this.settings.heterogeneity.length>0){var t=this.settings.heterogeneity;var n=0;var r=this.settings.from;for(var i=0;i<=t.length;i++){if(t[i])var s=t[i].split("/");else var s=[100,this.settings.to];s[0]=new Number(s[0]);s[1]=new Number(s[1]);if(e>=n&&e<=s[0]){var o=r+(e-n)*(s[1]-r)/(s[0]-n)}n=s[0];r=s[1]}}else{var o=this.settings.from+e*this.settings.interval/100}return this.round(o)};r.prototype.valueToPrc=function(e,t){if(this.settings.heterogeneity&&this.settings.heterogeneity.length>0){var n=this.settings.heterogeneity;var r=0;var i=this.settings.from;for(var s=0;s<=n.length;s++){if(n[s])var o=n[s].split("/");else var o=[100,this.settings.to];o[0]=new Number(o[0]);o[1]=new Number(o[1]);if(e>=i&&e<=o[1]){var u=t.limits(r+(e-i)*(o[0]-r)/(o[1]-i))}r=o[0];i=o[1]}}else{var u=t.limits((e-this.settings.from)*100/this.settings.interval)}return u};r.prototype.round=function(e){e=Math.round(e/this.settings.step)*this.settings.step;if(this.settings.round)e=Math.round(e*Math.pow(10,this.settings.round))/Math.pow(10,this.settings.round);else e=Math.round(e);return e};r.prototype.nice=function(t){t=t.toString().replace(/,/gi,".").replace(/ /gi,"");if(e.formatNumber){return e.formatNumber(new Number(t),this.settings.format||{}).replace(/-/gi,"&minus;")}else{return new Number(t)}};i.prototype=new Draggable;i.prototype.oninit=function(e,t,n){this.uid=t;this.parent=n;this.value={};this.settings=this.parent.settings};i.prototype.onmousedown=function(e){this._parent={offset:this.parent.domNode.offset(),width:this.parent.domNode.width()};this.ptr.addDependClass("hover");this.setIndexOver()};i.prototype.onmousemove=function(e,t){var n=this._getPageCoords(e);this._set(this.calc(n.x))};i.prototype.onmouseup=function(t){if(this.parent.settings.callback&&e.isFunction(this.parent.settings.callback))this.parent.settings.callback.call(this.parent,this.parent.getValue());this.ptr.removeDependClass("hover")};i.prototype.setIndexOver=function(){this.parent.setPointersIndex(1);this.index(2)};i.prototype.index=function(e){this.ptr.css({zIndex:e})};i.prototype.limits=function(e){return this.parent.limits(e,this)};i.prototype.calc=function(e){var t=this.limits((e-this._parent.offset.left)*100/this._parent.width);return t};i.prototype.set=function(e,t){this.value.origin=this.parent.round(e);this._set(this.parent.valueToPrc(e,this),t)};i.prototype._set=function(e,t){if(!t)this.value.origin=this.parent.prcToValue(e);this.value.prc=e;this.ptr.css({left:e+"%"});this.parent.redraw(this)}})(jQuery)
